<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>{% if page.use-site-title %}{{ site.title }} {{ site.title-separator }} {{ site.description }}{% elsif page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>

  <meta name="author" content="{{ site.author.name }}" />

  {% if page.subtitle %}
  <meta name="description" content="{{ page.subtitle }}">
  {% endif %}

  <link rel="alternate" type="application/rss+xml" title="{{ site.title }} {{ site.title-separator }} {{ site.description }}" href="{{ site.baseurl }}/feed.xml" />

  {% include gtm_head.html %}

  {% if layout.common-ext-css %}
    {% for css in layout.common-ext-css %}
      {% include ext-css.html css=css %}
    {% endfor %}
  {% endif %}

  {% if layout.common-css %}
    {% for css in layout.common-css %}
      <link rel="stylesheet" href="{{ css | prepend: site.baseurl | replace: '//', '/' }}" />
    {% endfor %}
  {% endif %}

  {% if layout.common-googlefonts %}
    {% for font in layout.common-googlefonts %}
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family={{ font }}" />
    {% endfor %}
  {% endif %}

  {% if page.ext-css %}
    {% for css in page.ext-css %}
      {% include ext-css.html css=css %}
    {% endfor %}
  {% endif %}

  {% if page.css %}
    {% for css in page.css %}
      <link rel="stylesheet" href="{{ css | prepend: site.baseurl | replace: '//', '/' }}" />
    {% endfor %}
  {% endif %}

  {% if page.googlefonts %}
    {% for font in page.googlefonts %}
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family={{ font }}" />
    {% endfor %}
  {% endif %}

  {% if site.matomo %}
  {% include matomo.html %}
  {% endif %}
</head>




<head>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ONNI</title>
  <meta name="GOLD-PEGGED PRICE STABLE & HEMIVOLATILE" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.airswap.io/gallery/airswap-trader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    <script type="text/javascript">

    console.log(web3); // {eth: .., shh: ...} // it's here!

    if (typeof web3 !== 'undefined') {
      web3 = new Web3(web3.currentProvider);
    } else {
      // set the provider you want from Web3.providers
      web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
    }

    const AirSwap = require('./nodejs/lib/AirSwap.js')

    const config = {
      privateKey: process.env.PRIVATE_KEY,
      infuraKey: process.env.INFURA_KEY,
      networkId: 'mainnet',
    }

    const airswap = new AirSwap(config)

    // Connect to AirSwap, then execute a callback on success
    airswap
      .connect()
      .then(() => {
        // Query the indexer for trade intents
        airswap
          .findIntents(
            ['0xBd9c6028e1132A6B52F1ca15C0933A2FD342E21f'], // AST
            ['0x0000000000000000000000000000000000000000'], // ETH
            'maker', // role
          )
          .then(intents => {
            console.log('Got Intents:', intents)
            return intents
          })
          // Request orders from peers whose trade intents were found on the indexer
          .then(intents => airswap.getOrders(intents, 1000000000000000000))
          // `orders` is an array of signed orders and/or errors. The order objects are already signed by the maker.
          // If we want to fill an order, we just have to sign the transaction and submit it to the AirSwap smart contract
          .then(orders => {
            console.log('Got orders:', orders)

            /* Warning: The example below will attempt to execute a trade for 10 AST regardless of price
             * You should always check the `takerAmount` and `makerAmount` to make sure it's a fair trade!

             const [order] = orders.filter(
               o =>
                 o.code !== -1 && o.makerAddress.toLowerCase() !== airswap.wallet.address.toLowerCase(),
             )
             if (order) {
               airswap
                 .fillOrder(order, { value: order.takerAmount })
                 .then(r => {
                   console.log('Order fill success:', r.hash)
                 })
                 .catch(e => console.error('Order fill failure:', e))
            */

            airswap.disconnect()
          })
          .catch(console.error)

        // Publish an array of trade intents to the indexer
        airswap
          .setIntents([
            {
              makerToken: '0xBd9c6028e1132A6B52F1ca15C0933A2FD342E21f',
              takerToken: '0x0000000000000000000000000000000000000000',
              role: 'maker',
            },
          ])
          .then(
            r => (r === 'ok' ? console.log('setIntents sucess') : console.log('setIntents failure')),
          )
          .catch(console.error)

        // Implement your own methods to handle RPC calls from other peers
        // This getOrder example is hardcoded to offer 1 AST for 0.001 ETH
        airswap.RPC_METHOD_ACTIONS.getOrder = msg => {
          const {
            makerAddress,
            makerAmount,
            makerToken,
            takerAddress,
            takerAmount,
            takerToken,
          } = msg.params
          const nonce = String(Math.round(Math.random() * Date.now()))
          const expiration = Date.now() + 30000

          const signedOrder = airswap.signOrder({
            makerAddress: airswap.wallet.address.toLowerCase(),
            makerAmount: '1000000000000000000',
            makerToken,
            takerAddress,
            takerAmount: '66700000000000000',
            takerToken,
            nonce,
            expiration,
          })
          airswap.call(
            takerAddress, // send order to address who requested it
            { id: msg.id, jsonrpc: '2.0', result: signedOrder }, // response id should match their `msg.id`
          )
        }
      })
      .catch(e => {
        throw e
      })

        function buy() {
          AirSwap.Trader.render({
              env: 'production',
              mode: 'buy',
              token: '0xBd9c6028e1132A6B52F1ca15C0933A2FD342E21f',
              amount: 1 * (10 ** 18),
              onCancel: function () {
                  console.info('Trade was canceled.');
              },
              onComplete: function(transactionId) {
                  console.info('Trade complete. Thank you, come again.');
              }
          }, 'body');
        }
        function sell() {
          AirSwap.Trader.render({
              env: 'production',
              mode: 'sell',
              token: '0xBd9c6028e1132A6B52F1ca15C0933A2FD342E21f',
              onCancel: function () {
                  console.info('Trade was canceled.');
              },
              onComplete: function(transactionId) {
                  console.info('Trade complete. Thank you, come again.');
              }
          }, 'body');
        }
    </script>
</head>
